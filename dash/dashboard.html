{% extends "dashboard_base.html" %}
{% block dashboard_content %}
    <style>
        #dashboard-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            width: 95%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem;
        }
        .dashboard-module {
            flex: 1 1 calc(50% - 0.5rem);
            min-width: 400px;
            transition: all 0.3s ease;
            position: relative;
            background: var(--bg-secondary);
            border-radius: 0.375rem;
        }
        .dashboard-module.dragging {
            opacity: 0.6;
            transform: scale(0.98);
            z-index: 1000;
            box-shadow: 0 8px 24px rgba(0,0,0,0.25);
        }
        .dashboard-module.hidden {
            display: none;
        }
        .dashboard-module.full-width {
            flex: 1 1 100%;
            min-width: 100%;
        }
        .dashboard-module.drag-over {
            border: 3px solid #0d6efd;
            background-color: rgba(13, 110, 253, 0.05);
        }
        .drop-zone {
            position: relative;
            min-height: 50px;
            border: 2px dashed var(--border-color);
            border-radius: 0.375rem;
            background-color: rgba(0, 123, 255, 0.03);
            transition: all 0.2s ease;
            display: none;
        }
        .drop-zone.active {
            display: block;
            border-color: #0d6efd;
            background-color: rgba(13, 110, 253, 0.1);
        }
        .dashboard-module .card {
            height: 100%;
            margin-bottom: 0;
        }
        .dashboard-module .card-body {
            overflow: auto;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .dashboard-module table {
            table-layout: auto;
            width: 100%;
        }
        .dashboard-module td,
        .dashboard-module th {
            white-space: normal;
            word-wrap: break-word;
            min-font-size: 6px;
        }
        .drag-handle {
            cursor: move;
            padding: 4px 10px;
            font-size: 1.1rem;
            color: var(--text-secondary);
            transition: color 0.2s;
        }
        .drag-handle:hover {
            color: #0d6efd;
        }
        .hide-toggle {
            cursor: pointer;
            padding: 4px 10px;
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-left: 8px;
            transition: color 0.2s;
        }
        .hide-toggle:hover {
            color: #dc3545;
        }
        .custom-widget-content {
            min-height: 150px;
        }
        .copy-value {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 2px;
        }
        .copy-value:hover {
            color: #0d6efd;
        }
        @media (max-width: 1024px) {
            .dashboard-module {
                flex: 1 1 100%;
                min-width: 100%;
            }
        }
        @media (max-width: 768px) {
            #dashboard-grid {
                width: 100%;
                padding: 0.5rem;
                gap: 0.75rem;
            }
            .dashboard-module {
                min-width: 0;
            }
            .dashboard-module .card-header {
                padding: 0.85rem 1rem;
                font-size: 1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .dashboard-module .card-body {
                padding: 0.75rem;
            }
            .dashboard-module table {
                font-size: 0.85rem;
            }
            .dashboard-module td,
            .dashboard-module th {
                padding: 0.5rem 0.4rem;
            }
            /* Make tables horizontally scrollable */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            /* Larger buttons on mobile */
            .btn {
                min-height: 44px;
                padding: 0.5rem 0.875rem;
            }
            .btn-sm {
                min-height: 44px;
                padding: 0.5rem 0.75rem;
                font-size: 0.95rem;
            }
            /* Stack action buttons vertically */
            .text-end.mb-3 {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
            }
            .text-end.mb-3 .btn,
            .text-end.mb-3 a {
                width: 100%;
                text-align: center;
            }
            /* Collapsible card headers on mobile */
            .dashboard-module .card-header {
                cursor: pointer;
                user-select: none;
            }
            .dashboard-module .card-header::after {
                content: '\f282';
                font-family: 'bootstrap-icons';
                float: right;
                transition: transform 0.3s;
            }
            .dashboard-module.collapsed .card-header::after {
                transform: rotate(-90deg);
            }
            .dashboard-module.collapsed .card-body {
                display: none;
            }
        }
        @media (max-width: 480px) {
            .dashboard-title {
                font-size: 1.5rem;
            }
            .dashboard-module .card-header {
                font-size: 0.95rem;
            }
            .dashboard-module table {
                font-size: 0.8rem;
            }
        }
    </style>
    
    <div class="text-end mb-3">
        <button id="login-btn" class="btn btn-outline-primary btn-sm" onclick="promptLogin()">Login</button>
        <button id="logout-btn" class="btn btn-outline-secondary btn-sm d-none" onclick="logout()">Logout</button>
        <a id="config-link" href="/config" class="btn btn-outline-success btn-sm d-none" title="Dashboard Configuration"><i class="bi bi-gear-fill"></i> Config</a>
        <button id="reset-layout-btn" class="btn btn-outline-warning btn-sm d-none" onclick="resetDashboardLayout()" title="Reset to default layout"><i class="bi bi-arrow-clockwise"></i> Reset Layout</button>
        <button id="show-hidden-btn" class="btn btn-outline-info btn-sm d-none" onclick="showHiddenModules()" title="Show hidden modules"><i class="bi bi-eye"></i> Show Hidden</button>
        <a href="https://github.com/Atomsk865/DownloadsOrganizeR" target="_blank" class="btn btn-outline-dark btn-sm">GitHub</a>
        <button id="service-name-btn" class="btn btn-outline-info btn-sm" style="display:none; margin-left:6px;" onclick="copyServiceName()" title="Click to copy service name">Service: <span id="service-name">...</span></button>
    </div>
    
    <!-- Main Dashboard Container -->
    <div class="container-fluid px-3">
        <div id="dashboard-grid" style="margin: 0 auto; max-width: 1600px;">
            <!-- System Info Card (Top, non-draggable) -->
            <div class="dashboard-module full-width" data-module="system-info" draggable="false">
                <div class="card">
                    <div class="card-header d-flex align-items-center">
                        <b>System Information</b>
                        <small class="text-muted ms-2">(Click any value to copy)</small>
                    </div>
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-md-3"><small><b>Hostname:</b> <span class="copy-value" onclick="copyToClipboard('{{ hostname }}', this)" title="Click to copy">{{ hostname }}</span></small></div>
                            <div class="col-md-3"><small><b>OS:</b> <span class="copy-value" onclick="copyToClipboard('{{ os }}', this)" title="Click to copy">{{ os }}</span></small></div>
                            <div class="col-md-3"><small><b>CPU:</b> <span class="copy-value" onclick="copyToClipboard('{{ cpu }}', this)" title="Click to copy">{{ cpu }}</span></small></div>
                            <div class="col-md-3"><small><b>RAM:</b> <span class="copy-value" onclick="copyToClipboard('{{ ram_gb }} GB', this)" title="Click to copy">{{ ram_gb }} GB</span></small></div>
                        </div>
                        <div class="row mt-1">
                            <div class="col-md-3"><small><b>GPU:</b> <span class="copy-value" onclick="copyToClipboard('{{ gpu }}', this)" title="Click to copy">{{ gpu }}</span></small></div>
                            <div class="col-md-3"><small><b>Private IP:</b> <span class="copy-value" onclick="copyToClipboard('{{ private_ip }}', this)" title="Click to copy">{{ private_ip }}</span></small></div>
                            <div class="col-md-3">
                                <small><b>Public IP:</b> <span id="public-ip-display" class="copy-value" onclick="copyPublicIP(this)" onmouseover="revealPublicIP()" onmouseout="hidePublicIP()" title="Hover to reveal, click to copy" style="cursor:pointer;">•••.•••.•••.•••</span></small>
                                <iframe src="https://ipchicken.com" style="display:none;" id="ipchicken-frame" onload="extractPublicIP()"></iframe>
                            </div>
                            <div class="col-md-3">
                                <a href="https://www.speedtest.net/" target="_blank" class="btn btn-outline-secondary btn-sm">Speed Test</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Service Status -->
            <div class="dashboard-module" data-module="service-status" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>Service Status & Resource Usage</b>
                            <span class="hide-toggle" onclick="toggleHideModule('service-status')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <div class="mb-2">
                                <small><b>Status:</b></small>
                                <span id="service-badge" class="badge bg-{{ 'success' if service_status == 'Running' else 'danger' }} ms-1">{{ service_status }}</span>
                                <div class="d-inline-flex gap-2 ms-2">
                                    <button class="btn btn-success btn-sm" onclick="serviceAction('start')">Start</button>
                                    <button class="btn btn-warning btn-sm" onclick="serviceAction('stop')">Stop</button>
                                    <button class="btn btn-primary btn-sm" onclick="serviceAction('restart')">Restart</button>
                                </div>
                            </div>
                            <div class="mb-2">
                                <small><b>Memory Usage:</b></small>
                                <span class="text-sm">Service: {{ service_memory_mb }} MB | System: {{ total_memory_mb }}/{{ total_memory_gb }}GB</span>
                                <div class="progress mb-1" style="height:18px;">
                                    <div class="progress-bar {% if ram_percent < 50 %}bg-success{% elif ram_percent < 80 %}bg-warning{% else %}bg-danger{% endif %}" role="progressbar" style="width: {{ ram_percent }}%; font-size:11px;">{{ ram_percent }}%</div>
                                </div>
                            </div>
                            <div class="mb-2">
                                <small><b>CPU Usage:</b></small>
                                <span class="text-sm">Service: {{ service_cpu_percent }}% | System: {{ total_cpu_percent }}%</span>
                                <div class="progress mb-1" style="height:18px;">
                                    <div class="progress-bar {% if total_cpu_percent < 50 %}bg-success{% elif total_cpu_percent < 80 %}bg-warning{% else %}bg-danger{% endif %}" role="progressbar" style="width: {{ total_cpu_percent }}%; font-size:11px;">{{ total_cpu_percent }}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
            </div>
            
            <!-- File Organization Statistics -->
            <!-- Duplicate Files Detection -->
            <div class="dashboard-module full-width" data-module="duplicates" draggable="true">
                    <div class="card">
                    <div class="card-header d-flex align-items-center">
                        <b><i class="bi bi-files"></i> Duplicate Files</b>
                        <span id="badge-duplicates-state" class="badge bg-secondary ms-2">Unknown</span>
                        <a href="/docs/duplicate-detection" target="_blank" class="ms-2 text-decoration-none" title="Open documentation">
                            <small><i class="bi bi-book"></i> Docs</small>
                        </a>
                        <span class="hide-toggle" onclick="toggleHideModule('duplicates')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                        <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                    </div>
                    <div id="duplicates-disabled-banner" class="alert alert-warning m-3 d-none" role="alert">
                        <i class="bi bi-slash-circle"></i> Duplicates feature is disabled. Enable it in Features & Integrations.
                    </div>
                    <div class="card-body" id="duplicates-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <span class="badge bg-warning" id="duplicates-count">0 duplicate groups</span>
                                <span class="badge bg-danger" id="wasted-space">0 B wasted</span>
                                <span class="badge bg-info" id="watched-folders-badge" title="Watched folders">watching 0</span>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="loadDuplicates()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                        
                        <div id="duplicates-container">
                            <div class="text-center text-muted">
                                <i class="bi bi-hourglass-split fs-1"></i>
                                <p>Loading duplicates...</p>
                            </div>
                        </div>
                        <div class="mt-2" id="watched-folders-list" style="display:none">
                            <small class="text-muted">Watched folders:</small>
                            <ul class="mb-0" id="watched-folders-ul"></ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- File Organization Statistics -->
            <div class="dashboard-module full-width" data-module="statistics" draggable="true">
                <div class="card">
                    <div class="card-header d-flex align-items-center">
                        <b><i class="bi bi-graph-up"></i> File Organization Statistics</b>
                        <span id="badge-reports-state" class="badge bg-secondary ms-2">Unknown</span>
                        <span class="hide-toggle" onclick="toggleHideModule('statistics')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                        <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                    </div>
                    <div id="reports-disabled-banner" class="alert alert-warning m-3 d-none" role="alert">
                        <i class="bi bi-slash-circle"></i> Reports feature is disabled. Enable it in Features & Integrations.
                    </div>
                    <div class="card-body" id="statistics-body">
                        <!-- Overview Stats -->
                        <div class="row mb-3">
                            <div class="col-md-2 col-6 text-center">
                                <div class="card bg-primary text-white">
                                    <div class="card-body p-2">
                                        <h4 class="mb-0" id="stat-total-files">0</h4>
                                        <small>Total Files</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="card bg-success text-white">
                                    <div class="card-body p-2">
                                        <h4 class="mb-0" id="stat-today">0</h4>
                                        <small>Today</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="card bg-info text-white">
                                    <div class="card-body p-2">
                                        <h4 class="mb-0" id="stat-week">0</h4>
                                        <small>This Week</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="card bg-warning text-white">
                                    <div class="card-body p-2">
                                        <h4 class="mb-0" id="stat-month">0</h4>
                                        <small>This Month</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="card bg-secondary text-white">
                                    <div class="card-body p-2">
                                        <h4 class="mb-0" id="stat-categories">0</h4>
                                        <small>Categories</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-6 text-center">
                                <div class="card bg-dark text-white">
                                    <div class="card-body p-2">
                                        <h4 class="mb-0" id="stat-avg-day">0</h4>
                                        <small>Avg/Day</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts Row -->
                        <div class="row">
                            <div class="col-lg-6 mb-3">
                                <h6>Files by Category</h6>
                                <canvas id="chart-category" height="200"></canvas>
                            </div>
                            <div class="col-lg-6 mb-3">
                                <h6>Top 10 File Extensions</h6>
                                <canvas id="chart-extensions" height="200"></canvas>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-3">
                                <h6>Activity Timeline (Last 30 Days)</h6>
                                <canvas id="chart-timeline" height="80"></canvas>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <h6>Activity by Hour of Day</h6>
                                <canvas id="chart-hourly" height="80"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-12 col-xl-6 dashboard-module" data-module="task-manager" draggable="true">
                    <!-- Task Manager Card -->
                    <div class="card mb-3">
                        <div class="card-header d-flex align-items-center">
                            <b>Task Manager (Top 5 by CPU)</b>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th><small>PID</small></th>
                                        <th><small>Name</small></th>
                                        <th><small>CPU %</small></th>
                                        <th><small>RAM MB</small></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for proc in top_processes %}
                                    <tr>
                                        <td><small>{{ proc.pid }}</small></td>
                                        <td><small>{{ proc.name }}</small></td>
                                        <td><small>{{ proc.cpu|round(1) }}</small></td>
                                        <td><small>{{ proc.mem }}</small></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
            </div>
                    
            <div class="col-12 col-xl-6 dashboard-module" data-module="recent-files" draggable="true">
                    <!-- Recent Files Card -->
                    <div class="card mb-3">
                        <div class="card-header d-flex align-items-center">
                            <b>Recent File Movements</b>
                            <a href="/docs/recent-files" target="_blank" class="ms-2 text-decoration-none" title="Open documentation">
                                <small><i class="bi bi-book"></i> Docs</small>
                            </a>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <div class="d-flex justify-content-end mb-1">
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshRecentFiles()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                        <div id="recent-files-list" class="table-responsive">
                            <table class="table table-sm table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Filename</th>
                                        <th>Category</th>
                                        <th>Actions</th>
                                        <th style="width:50px"></th>
                                    </tr>
                                </thead>
                                <tbody id="recent-files-tbody">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">Loading recent files...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- Drive Space -->
            <div class="dashboard-module" data-module="drive-space" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>Drive Space</b>
                            <span class="hide-toggle" onclick="toggleHideModule('drive-space')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <table class="table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>Device</th>
                                    <th>Total</th>
                                    <th>Used</th>
                                    <th>Usage</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for drive in drives %}
                                <tr>
                                    <td>{{ drive.device }}</td>
                                    <td><small>{{ drive.total }}</small></td>
                                    <td><small>{{ drive.used }}</small></td>
                                    <td>
                                        <div class="progress" style="min-width: 50px;">
                                            <div class="progress-bar {% if drive.percent < 50 %}bg-success{% elif drive.percent < 80 %}bg-warning{% else %}bg-danger{% endif %}" role="progressbar" style="width: {{ drive.percent }}%; font-size:11px;">{{ drive.percent }}%</div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        </div>
                    </div>
            </div>
                    
            <!-- Settings -->
            <div class="dashboard-module" data-module="settings" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>Settings</b>
                            <span class="hide-toggle" onclick="toggleHideModule('settings')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                        <form id="config-form-settings">
                            <div class="row mb-2">
                                <div class="col-md-12">
                                    <label class="form-label" style="font-size: 0.85rem;"><b>Watch Folder</b></label>
                                    <input class="form-control form-control-sm" type="text" name="watch_folder" value="{{ watch_folder }}" placeholder="e.g., C:\Users\YourName\Downloads">
                                    <small class="form-text text-muted">The folder to monitor for new files. Leave empty to use the default Downloads folder.</small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label class="form-label" style="font-size: 0.85rem;"><b>Memory Threshold (MB)</b></label>
                                    <input class="form-control form-control-sm" type="number" name="memory_threshold" value="{{ memory_threshold }}">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" style="font-size: 0.85rem;"><b>CPU Threshold (%)</b></label>
                                    <input class="form-control form-control-sm" type="number" name="cpu_threshold" value="{{ cpu_threshold }}">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" style="font-size: 0.85rem;"><b>Logs Directory</b></label>
                                    <input class="form-control form-control-sm" type="text" name="logs_dir" value="{{ logs_dir }}">
                                </div>
                            </div>
                            <div class="alert alert-warning alert-sm mt-2 mb-2 py-1 px-2" role="alert" style="font-size: 0.85rem;">
                                <i class="bi bi-exclamation-triangle"></i> <strong>Important:</strong> Changing the watch folder requires restarting the Organizer service.
                            </div>
                            <button class="btn btn-primary btn-sm mt-2" type="button" onclick="saveSettings()">Save Settings</button>
                        </form>
                        </div>
                    </div>
            </div>
                
            <!-- File Categories -->
            <div class="dashboard-module" data-module="file-categories" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>File Categories</b>
                            <span class="hide-toggle" onclick="toggleHideModule('file-categories')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <div class="alert alert-info alert-sm mb-2 py-1 px-2" role="alert" style="font-size: 0.85rem;">
                                <i class="bi bi-info-circle"></i> <strong>Note:</strong> Changes to file categories and custom routes require restarting the Organizer service to take effect.
                            </div>
                            <form id="config-form">
                            <table class="table table-sm mb-3">
                                <thead>
                                    <tr>
                                        <th>Folder</th>
                                        <th>Extensions (comma-separated)</th>
                                        <th style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ...existing file categories rows... -->
                                    <!-- Images -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_1" value="Images"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_1" value="jpg, jpeg, png, gif, bmp, tiff, svg, webp, heic, ico, raw, psd, ai, eps">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- ...other categories as before... -->
                                    <!-- Music -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_2" value="Music"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_2" value="mp3, wav, flac, aac, ogg, wma, m4a, alac, aiff, opus, amr, mid, midi">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Videos -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_3" value="Videos"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_3" value="mp4, mkv, avi, mov, wmv, flv, webm, mpeg, mpg, m4v, 3gp, vob, ogv, ts, mts, m2ts">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Documents -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_4" value="Documents"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_4" value="pdf, doc, docx, txt, rtf, odt, xls, xlsx, ppt, pptx, csv, md, tex, epub, mobi, pages, numbers, key">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Archives -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_5" value="Archives"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_5" value="zip, rar, 7z, tar, gz, bz2, xz, iso, cab, arj, lzh, ace, uue, jar, tar.gz, tar.bz2">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Executables -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_6" value="Executables"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_6" value="exe, msi, bat, cmd, ps1, sh, app, deb, rpm, apk, com, bin, run">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Shortcuts -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_7" value="Shortcuts"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_7" value="lnk, url, desktop, webloc">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Scripts -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_8" value="Scripts"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_8" value="py, js, html, css, json, xml, sh, ts, php, rb, pl, swift, go, c, cpp, cs, java, scala, lua, r, ipynb, jsx, tsx">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Fonts -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_9" value="Fonts"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_9" value="ttf, otf, woff, woff2, fon, fnt, eot, svg">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Logs -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_10" value="Logs"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_10" value="log, out, err">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- Other -->
                                    <tr>
                                        <td><input class="form-control form-control-sm" type="text" name="folder_11" value="Other"></td>
                                        <td>
                                            <input class="form-control form-control-sm" type="text" name="exts_11" value="">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger btn-sm" type="button" onclick="deleteRow(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="d-flex gap-2 mt-2">
                                <button class="btn btn-success btn-sm" type="button" onclick="addCategoryRow()">Add Category</button>
                                <button class="btn btn-primary btn-sm" type="button" onclick="saveConfiguration()">Save Configuration</button>
                            </div>
                        </form>
                        </div>
                    </div>
            </div>
            
            <!-- Custom Routes -->
            <div class="dashboard-module" data-module="custom-routes" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>Custom Routes (Per-Extension)</b>
                            <span class="hide-toggle" onclick="toggleHideModule('custom-routes')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <form id="custom-routes-form">
                            <table class="table table-sm mb-3">
                                <thead>
                                    <tr>
                                        <th>Extension</th>
                                        <th>Target Folder</th>
                                        <th style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="custom-routes-tbody">
                                    <!-- Rows will be populated dynamically from config or added by user -->
                                </tbody>
                            </table>
                            <div class="d-flex gap-2 mt-2">
                                <button class="btn btn-success btn-sm" type="button" onclick="addCustomRouteRow()">Add Route</button>
                                <button class="btn btn-primary btn-sm" type="button" onclick="saveConfiguration()">Save Configuration</button>
                            </div>
                        </form>
                        <small class="text-muted">Custom routes take precedence over category routing.</small>
                        </div>
                    </div>
            </div>
                
            <!-- Tag Routes -->
            <div class="dashboard-module" data-module="tag-routes" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>Tag Routes (Filename-Based Routing)</b>
                            <span class="hide-toggle" onclick="toggleHideModule('tag-routes')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-2">
                            <div class="alert alert-info alert-sm mb-2 py-1 px-2" role="alert" style="font-size: 0.85rem;">
                                <i class="bi bi-info-circle"></i> <strong>Tip:</strong> Files containing the tag anywhere in the filename will be moved to the specified folder, regardless of extension. Tag routes have the highest priority.
                            </div>
                            <form id="tag-routes-form">
                            <table class="table table-sm mb-3">
                                <thead>
                                    <tr>
                                        <th>Tag/Keyword</th>
                                        <th>Target Folder (absolute path)</th>
                                        <th style="width: 80px;">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tag-routes-tbody">
                                    <!-- Rows will be populated dynamically from config or added by user -->
                                </tbody>
                            </table>
                            <div class="d-flex gap-2 mt-2">
                                <button class="btn btn-success btn-sm" type="button" onclick="addTagRouteRow()">Add Tag Route</button>
                                <button class="btn btn-primary btn-sm" type="button" onclick="saveConfiguration()">Save Configuration</button>
                            </div>
                        </form>
                        <small class="text-muted">Examples: "invoice" → Invoices folder, "screenshot" → Screenshots</small>
                        </div>
                    </div>
            </div>
            
            <!-- Custom Widget -->
            <div class="dashboard-module" data-module="custom-widget" draggable="true">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b>Custom Widget</b>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="editCustomWidget()">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <span class="hide-toggle" onclick="toggleHideModule('custom-widget')" title="Hide module"><i class="bi bi-x-circle"></i></span>
                            <span class="drag-handle ms-auto"><i class="bi bi-grip-vertical"></i></span>
                        </div>
                        <div class="card-body p-3 custom-widget-content" id="custom-widget-content">
                            <p class="text-muted text-center mb-0">Click Edit to add custom content, embeds, or widgets</p>
                        </div>
                    </div>
            </div>
        </div>
    </div>
        <!-- VirusTotal Modal -->
        <div class="modal fade" id="vtModal" tabindex="-1" aria-labelledby="vtModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="vtModalLabel">VirusTotal Scan Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="vtModalBody">
                            <div class="text-muted">No data</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a id="vtReportLink" href="#" target="_blank" class="btn btn-outline-secondary">Open VT Report</a>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    <!-- Login / Change-password Modal and scripts -->
    {% include "dashboard_scripts.html" %}
{% endblock %}
